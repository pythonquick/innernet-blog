
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/font-awesome/css/font-awesome.min.css">





  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Guenther" />
<meta name="description" content="In the recent lesson about AJAX we saw how to make a server request in the background (asynchronous), and then handling the server response in a function. If a second asynchronous server request depends on the first one, it becomes messy to manage the dependencies. For example, the second asynchronous ..." />
<meta name="keywords" content="JavaScript, jQuery">
<meta property="og:site_name" content="innernet"/>
<meta property="og:title" content="Promises in jQuery"/>
<meta property="og:description" content="In the recent lesson about AJAX we saw how to make a server request in the background (asynchronous), and then handling the server response in a function. If a second asynchronous server request depends on the first one, it becomes messy to manage the dependencies. For example, the second asynchronous ..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://localhost:8000/promises-in-jquery.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-08-17 00:00:00-04:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://localhost:8000/author/guenther.html">
<meta property="article:section" content="Tutorials"/>
<meta property="article:tag" content="JavaScript"/>
<meta property="article:tag" content="jQuery"/>
<meta property="og:image" content="http://s.gravatar.com/avatar/fcfe36f97f3eb56b69ecce65d0c895dc?s=80">

  <title>innernet &ndash; Promises in jQuery</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://localhost:8000">
        <img src="http://s.gravatar.com/avatar/fcfe36f97f3eb56b69ecce65d0c895dc?s=80" alt="" title="">
      </a>
      <h1><a href="http://localhost:8000"></a></h1>


      <nav>
        <ul class="list">
          <li><a href="http://localhost:8000/pages/about.html#about">About</a></li>

        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-You can add links in your config file" href="#" target="_blank"><i class="fa fa-You can add links in your config file"></i></a></li>
        <li><a class="sc-Another social link" href="#" target="_blank"><i class="fa fa-Another social link"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>
    <nav>
      <a href="http://localhost:8000">    Home
</a>

      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>
      <a href="/archives.html">Archives</a>


    </nav>

<article class="single">
  <header>
    <h1 id="promises-in-jquery">Promises in jQuery</h1>
    <p>
          Posted on Wed 17 August 2016 in <a href="http://localhost:8000/category/tutorials.html">Tutorials</a>


    </p>
  </header>
  <div>
    <p>In the recent lesson about AJAX we saw how to make a server request in the background (asynchronous), and then handling the server response in a function. If a second asynchronous server request depends on the first one, it becomes messy to manage the dependencies. For example, the second asynchronous server request can be initiated in the response handler function of the first server request. This leads to long chains of calls that can be hard to read and make sense of.</p>
<p>To make composition of multiple asynchronous requests more manageable, the concept of a Promise was introduced. A Promise basically represents an action with an eventual outcome. By representing this eventual outcome as a promise object, the interaction between multiple promise objects can easily be expressed even when their results are not yet available. The <a href="https://promisesaplus.com">Promises/A+ specification</a> details the behavior and interface of promise objects. This way there is a standard interface for interacting with promises, independent of the actual promise-implementing library. </p>
<p>jQuery provides the <a href="http://api.jquery.com/category/deferred-object/">Deferred Object</a> which is a promise object. When making an AJAX call with jQuery's $.ajax method (or with one of the convenience methods like $.get), the returned object implements the promise interface, just like the Deferred object. This way, multiple jQuery AJAX call objects can be coordinated using the mechanisms provided by promises.</p>
<p>First, let's look at some other means of making asynchronous calls. The built-in JavaScript functions <code>setTimeout</code> and <code>setInterval</code> can be used to make delayed function calls.</p>
<h1>Delayed function execution</h1>
<p>The JavaScript <code>setTimeout</code> function can be used to call a function in the future, by specifying the function to be called and the time (in milliseconds) to wait until the function gets called. Here's an example:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">sayHello</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">sayHello</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>
</pre></div>


<p>Here, the sayHello function will show an alert popup box with the text "hello", but only after 5 seconds.</p>
<p>The function <code>setInterval</code> will also call the function after the specified delay, but it will repeatedly call the function:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">sayHello</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">setInterval</span><span class="p">(</span><span class="nx">sayHello</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>
</pre></div>


<p>Here, the sayHello function will be called every 5 seconds.
Note: when using <code>setTimeout</code> or <code>setInterval</code>, the queued function call can be canceled. To cancel the call, use the JavaScript built-in function <code>clearTimeout</code> which takes the timer ID returned by a previous call to <code>setTimeout</code> or <code>setInterval</code>.</p>
<p>For example, the following will start a recurring call to function logGreeting every second. After 8 seconds, it will stop and cancel the recurring function calls:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">logGreeting</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;hello at &#39;</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">timerId</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="nx">logGreeting</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>

<span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timerId</span><span class="p">);</span>
<span class="p">},</span> <span class="mi">8000</span><span class="p">);</span>
</pre></div>


<h1>jQuery done method</h1>
<p>When making a jQuery AJAX call, the <code>done</code> method can be used to attach a response handling function, to be called when the AJAX call finishes successfully.
The jQuery AJAX call (e.g. methods $.ajax or $.get) returns an object that is referred to as "jqXHR". 
The <code>done</code> method can be called on the jqXHR object to attach a function that will handle the eventual server response, if the server request was successful. Similar to <code>done</code>, there's also a fail method to attach a failure handling function and an <code>always</code> method that will be executed regardless of whether the call was successful or unsuccessful.</p>
<p>Consider the following function that makes a call to the Open Weather API server:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">API_KEY</span> <span class="o">=</span> <span class="s1">&#39;05e394dfc3d1b822698f06d759bc4c95&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">WEATHER_SERVICE_URL</span> <span class="o">=</span> <span class="s1">&#39;http://api.openweathermap.org/data/2.5/weather&#39;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="nx">city</span><span class="p">,</span> <span class="nx">country</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;Weather in &#39;</span> <span class="o">+</span> <span class="nx">city</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;: &lt;/li&gt;&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#weatherlist&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">q</span><span class="o">:</span> <span class="nx">city</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nx">country</span><span class="p">,</span>
        <span class="nx">APPID</span><span class="o">:</span> <span class="nx">API_KEY</span>
    <span class="p">};</span>
    <span class="k">return</span> <span class="nx">$</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">WEATHER_SERVICE_URL</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">weather</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">weather</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">weather</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
            <span class="kd">var</span> <span class="nx">kelvin</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">temp</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">fahrenheit</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">((</span><span class="nx">kelvin</span> <span class="o">-</span> <span class="mi">273</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.8</span> <span class="o">+</span> <span class="mi">32</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;span class=&quot;desc&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">weather</span><span class="p">.</span><span class="nx">description</span> <span class="o">+</span> <span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;span class=&quot;temp&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nx">fahrenheit</span> <span class="o">+</span> <span class="s1">&#39; F&lt;/span&gt;&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>


<p>This function first adds a new <li> tag to the parent page's <ul> list with the ID of "weatherlist". It makes a call to api.openweathermap.org for the specified city. When the request gets back the weather data, it adds the weather description and temperature.
Note that this function returns the jqXHR object returned by the jQuery AJAX function. In this case it calls the $.get helper function.</p>
<p>Here's a function that uses the jQuery <code>done</code> methods on the jqXHR object returned by the fetchWeather function:</p>
<div class="highlight"><pre><span></span><span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;boston&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">done</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;lima&#39;</span><span class="p">,</span> <span class="s1">&#39;peru&#39;</span><span class="p">);</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">done</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;nashua&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span> <span class="p">})</span>
    <span class="p">.</span><span class="nx">done</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;hannover&#39;</span><span class="p">,</span> <span class="s1">&#39;germany&#39;</span><span class="p">);</span> <span class="p">});</span>
</pre></div>


<p>When looking at the network requests in the Chrome Inspector's Network tab, we see that the weather requests for lima, nashua and hannover happen after the first request for boston. </p>
<p><img alt="jQuery done" src="https://innernet.io/media/jquery-weather-done.png" /></p>
<p>The last three requests basically start simultaneously. This is because the requests for lima, nashua and hannover are all attached as "<code>done</code>" handlers to the original boston request. The <code>done</code> method returns the original jqXHR object, allowing multiple method calls to be chained. That means the above is equivalent to doing the following:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">bostonRequest</span> <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;boston&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="nx">bostonRequest</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;lima&#39;</span><span class="p">,</span> <span class="s1">&#39;peru&#39;</span><span class="p">);</span> <span class="p">});</span>
<span class="nx">bostonRequest</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;nashua&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span> <span class="p">});</span>
<span class="nx">bostonRequest</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;hannover&#39;</span><span class="p">,</span> <span class="s1">&#39;germany&#39;</span><span class="p">);</span> <span class="p">});</span>
</pre></div>


<h1>jQuery Deferred object</h1>
<p>In jQuery, the the <a href="http://api.jquery.com/category/deferred-object/">Deferred Object</a> can be used to represent a Promise.</p>
<p>Promises represent an eventual outcome. There is therefore some state attached to the promise object. The three states for promises are: </p>
<ul>
<li>pending: This is the initial state. There is no outcome yet</li>
<li>fulfilled: The eventual value is available and the request is successful.</li>
<li>rejected; The eventual value is available and the request is unsuccessful.</li>
</ul>
<p>jQuery's $.ajax (and related) methods return a jqXHR function that implement the promise interface. In Many cases these "project objects" can be used as-is. 
If we need more control over a promise - like when the promise is fulfilled or rejected, and what the eventual value is - we can create a jQuery Deferred object to manage the promise.</p>
<p>Here's one example of using a jQuery Deferred object to fetch the weather slowly:</p>
<div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">fetchWeatherSlowly</span><span class="p">(</span><span class="nx">city</span><span class="p">,</span> <span class="nx">country</span><span class="p">,</span> <span class="nx">prevCountry</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">weatherRequest</span> <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="nx">city</span><span class="p">,</span> <span class="nx">country</span><span class="p">,</span> <span class="nx">prevCountry</span><span class="p">);</span>
    <span class="nx">weatherRequest</span><span class="p">.</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">apiJSON</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">apiJSON</span><span class="p">.</span><span class="nx">weather</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">apiJSON</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nx">promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="s2">&quot;Error received from API: &quot;</span> <span class="o">+</span> <span class="nx">apiJSON</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">promise</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>The Deferred object (the promise) will resolve 2 seconds after the AJAX request from the fetchWeather call returns a response.</p>
<p>The Deferred/promise object gets resolved or rejected by calling the resolve or reject methods, respectively. Optionally, a value can be specified. In the above example, the fetchWeather AJAX call's JSON response gets passed through to the Deferred/project object when it resolves.</p>
<h1>Chaining promises together</h1>
<p>There are cases when an AJAX call depends on a previous AJAX call's response. If multiple AJAX requests need to be "chained" together, one way is to initiate the second AJAX call in the first AJAX call's response handler function. When there are many calls in the chain, this quickly becomes hard to manage and reason about. Promise objects have a <code>then</code> method that can be used to chain together a sequence of promises. The <code>then</code> method takes two parameters. Both of these parameters are functions. The first function parameter is a success handler, which will be called if the promise resolved (completed successfully). The second function parameter is a failure handler, which will be called if the promise got rejected (completed unsuccessfully).</p>
<p>Here's an example that fetches the whether of a few cities, but sequentially (not in parallel):</p>
<div class="highlight"><pre><span></span><span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;boston&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bostonResponse</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;got boston!&#39;</span><span class="p">,</span> <span class="nx">bostonResponse</span><span class="p">);</span> 
        <span class="k">return</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;lynn&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span> 
     <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lynnResponse</span><span class="p">)</span> <span class="p">{</span> 
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;got lynn!&#39;</span><span class="p">,</span> <span class="nx">lynnResponse</span><span class="p">);</span>
        <span class="c1">// normally this function would fetch the weather for the city of Lima,</span>
        <span class="c1">// but we intentionally don&#39;t specify the city name to produce an error:</span>
        <span class="k">return</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
     <span class="p">})</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">limaResponse</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;got lima!&#39;</span><span class="p">,</span> <span class="nx">limaResponse</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;hannover&#39;</span><span class="p">,</span> <span class="s1">&#39;germany&#39;</span><span class="p">);</span> 
        <span class="p">},</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;could not load lima!&#39;</span><span class="p">);</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;here is the response:&#39;</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;hannover&#39;</span><span class="p">,</span> <span class="s1">&#39;germany&#39;</span><span class="p">);</span> 
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hannoverResponse</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;got hannover!&#39;</span><span class="p">,</span> <span class="nx">hannoverResponse</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;canton&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span> 
    <span class="p">});</span>
</pre></div>


<p>In Chrome Inspector's network tab, we see that the requests run sequentially - one after the other:</p>
<p><img alt="jQuery then" src="https://innernet.io/media/jquery-weather-then.png" /></p>
<p>Note: we intentially inserted a failed network request in the second <code>then</code> function call, where it makes a request with an empty city value. The following <code>then</code> function handles the error when the second function parameter gets called. Note: without the second function parameter, the <code>then</code> function would not contain a new promise object. The chain of <code>then</code> calls will continue as long as the previous <code>then</code> call returns a new promise for the next <code>then</code> call to act on.</p>
<h1>Managing sets of promises</h1>
<p>Sometimes we need to know when a set of promises have completed. jQuery's Deferred object interface provides a <code>when</code> method that can be used to attach a function whenever the specified set of promises resolves.</p>
<p>Here's an example that loads cities from three continents. As soon as all cities of a continent have loaded, a banner gets displayed on the page:</p>
<div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">amsterdam</span>        <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;amsterdam&#39;</span><span class="p">,</span> <span class="s1">&#39;netherlands&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">athens</span>           <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;athens&#39;</span><span class="p">,</span> <span class="s1">&#39;greece&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">barcelona</span>        <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;barcelona&#39;</span><span class="p">,</span> <span class="s1">&#39;spain&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">berlin</span>           <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;berlin&#39;</span><span class="p">,</span> <span class="s1">&#39;de&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cairo</span>            <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Cairo&#39;</span><span class="p">,</span> <span class="s1">&#39;egypt&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">capetown</span>         <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Capetown&#39;</span><span class="p">,</span> <span class="s1">&#39;south africa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">chicago</span>          <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Chicago&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">dallas</span>           <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Dallas&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">dublin</span>           <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;dublin&#39;</span><span class="p">,</span> <span class="s1">&#39;ireland&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">edinburgh</span>        <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;edinburgh&#39;</span><span class="p">,</span> <span class="s1">&#39;scottland&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">houston</span>          <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Houston&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">johannesburg</span>     <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;johannesburg&#39;</span><span class="p">,</span> <span class="s1">&#39;za&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">la</span>               <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Los Angeles&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">london</span>           <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;london&#39;</span><span class="p">,</span> <span class="s1">&#39;gb&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">milan</span>            <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;milan&#39;</span><span class="p">,</span> <span class="s1">&#39;italy&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">montreal</span>         <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Montreal&#39;</span><span class="p">,</span> <span class="s1">&#39;canada&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">nairobi</span>          <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;milan&#39;</span><span class="p">,</span> <span class="s1">&#39;kenya&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">nyc</span>              <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;New York&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">paris</span>            <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;paris&#39;</span><span class="p">,</span> <span class="s1">&#39;france&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">philadelphia</span>     <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Philadelphia&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">phoenix</span>          <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Phoenix&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">rome</span>             <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;roma&#39;</span><span class="p">,</span> <span class="s1">&#39;italy&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sanantonio</span>       <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;San Antonio&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sandiego</span>         <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;San Diego&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">sanjose</span>          <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;San Jose&#39;</span><span class="p">,</span> <span class="s1">&#39;usa&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">toronto</span>          <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Toronto&#39;</span><span class="p">,</span> <span class="s1">&#39;canada&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">vancouver</span>        <span class="o">=</span> <span class="nx">fetchWeather</span><span class="p">(</span><span class="s1">&#39;Vancouver&#39;</span><span class="p">,</span> <span class="s1">&#39;canada&#39;</span><span class="p">);</span>


<span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="nx">rome</span><span class="p">,</span> <span class="nx">paris</span><span class="p">,</span> <span class="nx">barcelona</span><span class="p">,</span> <span class="nx">london</span><span class="p">,</span> <span class="nx">amsterdam</span><span class="p">,</span> <span class="nx">dublin</span><span class="p">,</span> <span class="nx">athens</span><span class="p">,</span> <span class="nx">edinburgh</span><span class="p">,</span> <span class="nx">berlin</span><span class="p">,</span> <span class="nx">milan</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#continents&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;EUROPE loaded&lt;/div&gt;&#39;</span><span class="p">);</span>
    <span class="p">});</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="nx">nyc</span><span class="p">,</span> <span class="nx">la</span><span class="p">,</span> <span class="nx">chicago</span><span class="p">,</span> <span class="nx">houston</span><span class="p">,</span> <span class="nx">philadelphia</span><span class="p">,</span> <span class="nx">phoenix</span><span class="p">,</span> <span class="nx">sanantonio</span><span class="p">,</span> <span class="nx">sandiego</span><span class="p">,</span> <span class="nx">dallas</span><span class="p">,</span> <span class="nx">sanjose</span><span class="p">,</span> <span class="nx">toronto</span><span class="p">,</span> <span class="nx">montreal</span><span class="p">,</span> <span class="nx">vancouver</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#continents&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;NORTH AMERICA loaded&lt;/div&gt;&#39;</span><span class="p">);</span>
    <span class="p">});</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">(</span><span class="nx">johannesburg</span><span class="p">,</span> <span class="nx">cairo</span><span class="p">,</span> <span class="nx">nairobi</span><span class="p">,</span> <span class="nx">capetown</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#continents&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;AFRICA loaded&lt;/div&gt;&#39;</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>


<p>Here is a screenshot, showing loading of the requests and the banners that appear when each continent's group finished loading:</p>
<p><img alt="jQuery when" src="https://innernet.io/media/jquery-weather-when.gif" /></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="http://localhost:8000/tag/javascript.html">JavaScript</a>
      <a href="http://localhost:8000/tag/jquery.html">jQuery</a>
    </p>
  </div>



</article>

    <footer>
<p>&copy; Guenther </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " innernet ",
  "url" : "http://localhost:8000",
  "image": "http://s.gravatar.com/avatar/fcfe36f97f3eb56b69ecce65d0c895dc?s=80",
  "description": ""
}
</script>
</body>
</html>